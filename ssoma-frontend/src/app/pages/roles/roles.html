<div class="roles-page">
  <div class="page-header">
    <div class="header-content">
      <mat-icon class="page-icon">admin_panel_settings</mat-icon>
      <div>
        <h1>Gestión de Roles</h1>
        <p class="subtitle">Administra los roles y permisos del sistema</p>
      </div>
    </div>
    <button mat-raised-button color="primary" (click)="openRolDialog()">
      <mat-icon>add</mat-icon>
      Nuevo Rol
    </button>
  </div>

  <!-- Tabla de roles -->
  <div class="table-container mat-elevation-z2">
    <table mat-table [dataSource]="roles" class="roles-table">

      <!-- Nombre Column -->
      <ng-container matColumnDef="nombre">
        <th mat-header-cell *matHeaderCellDef>Nombre del Rol</th>
        <td mat-cell *matCellDef="let rol">
          <div class="rol-cell">
            <mat-icon class="rol-icon">shield</mat-icon>
            <span class="rol-nombre">{{ rol.nombre }}</span>
          </div>
        </td>
      </ng-container>

      <!-- Código Column -->
      <ng-container matColumnDef="codigo">
        <th mat-header-cell *matHeaderCellDef>Código</th>
        <td mat-cell *matCellDef="let rol">
          <code class="codigo-badge">{{ rol.codigo }}</code>
        </td>
      </ng-container>

      <!-- Descripción Column -->
      <ng-container matColumnDef="descripcion">
        <th mat-header-cell *matHeaderCellDef>Descripción</th>
        <td mat-cell *matCellDef="let rol">
          <span class="descripcion-text">{{ rol.descripcion }}</span>
        </td>
      </ng-container>

      <!-- Nivel Jerarquía Column -->
      <ng-container matColumnDef="nivelJerarquia">
        <th mat-header-cell *matHeaderCellDef>Nivel</th>
        <td mat-cell *matCellDef="let rol">
          <mat-chip [class]="getNivelColor(rol.nivelJerarquia)">
            {{ getNivelLabel(rol.nivelJerarquia) }}
          </mat-chip>
        </td>
      </ng-container>

      <!-- Requiere Tenant Column -->
      <ng-container matColumnDef="requiereTenant">
        <th mat-header-cell *matHeaderCellDef>Alcance</th>
        <td mat-cell *matCellDef="let rol">
          <div class="tenant-cell">
            <mat-icon [class.tenant-required]="rol.requiereTenant" [class.tenant-global]="!rol.requiereTenant">
              {{ rol.requiereTenant ? 'business' : 'public' }}
            </mat-icon>
            <span>{{ rol.requiereTenant ? 'Por Empresa' : 'Global' }}</span>
          </div>
        </td>
      </ng-container>

      <!-- Cantidad Usuarios Column -->
      <ng-container matColumnDef="usuarios">
        <th mat-header-cell *matHeaderCellDef>Usuarios</th>
        <td mat-cell *matCellDef="let rol">
          <div class="usuarios-count">
            <mat-icon>people</mat-icon>
            <span>{{ rol.cantidadUsuarios }}</span>
          </div>
        </td>
      </ng-container>

      <!-- Estado Column -->
      <ng-container matColumnDef="activo">
        <th mat-header-cell *matHeaderCellDef>Estado</th>
        <td mat-cell *matCellDef="let rol">
          <mat-chip
            [class.chip-activo]="rol.activo"
            [class.chip-inactivo]="!rol.activo">
            {{ rol.activo ? 'ACTIVO' : 'INACTIVO' }}
          </mat-chip>
        </td>
      </ng-container>

      <!-- Acciones Column -->
      <ng-container matColumnDef="acciones">
        <th mat-header-cell *matHeaderCellDef>Acciones</th>
        <td mat-cell *matCellDef="let rol">
          <div class="action-buttons">
            <button mat-icon-button
                    (click)="openRolDialog(rol)"
                    matTooltip="Editar rol"
                    color="primary">
              <mat-icon>edit</mat-icon>
            </button>

            <button mat-icon-button
                    (click)="toggleEstadoRol(rol)"
                    [matTooltip]="rol.activo ? 'Desactivar rol' : 'Activar rol'"
                    [color]="rol.activo ? 'warn' : 'accent'">
              <mat-icon>{{ rol.activo ? 'block' : 'check_circle' }}</mat-icon>
            </button>

            <button mat-icon-button
                    (click)="deleteRol(rol)"
                    matTooltip="Eliminar rol"
                    [disabled]="rol.cantidadUsuarios > 0"
                    color="warn">
              <mat-icon>delete</mat-icon>
            </button>
          </div>
        </td>
      </ng-container>

      <tr mat-header-row *matHeaderRowDef="displayedColumns"></tr>
      <tr mat-row *matRowDef="let row; columns: displayedColumns;"></tr>
    </table>

    <div *ngIf="roles.length === 0" class="no-results">
      <mat-icon>security</mat-icon>
      <p>No hay roles configurados</p>
      <small>Crea el primer rol para comenzar</small>
    </div>
  </div>

  <!-- Información adicional -->
  <div class="info-card">
    <mat-icon>info</mat-icon>
    <div class="info-content">
      <h3>Información sobre Roles</h3>
      <ul>
        <li><strong>Nivel 1:</strong> Super Administrador - Acceso completo sin restricciones de empresa</li>
        <li><strong>Nivel 2:</strong> Administrador de Empresa Principal - Gestiona una empresa y sus contratistas</li>
        <li><strong>Nivel 3:</strong> Administrador de Contratista - Gestiona una empresa contratista</li>
        <li><strong>Nivel 4:</strong> Usuarios - Acceso limitado según permisos asignados</li>
      </ul>
      <p class="warning">
        <mat-icon>warning</mat-icon>
        No se pueden eliminar roles que tengan usuarios asignados
      </p>
    </div>
  </div>
</div>
