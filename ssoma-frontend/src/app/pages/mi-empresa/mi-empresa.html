<div class="mi-empresa-container">

  <!-- Loading -->
  <div class="loading-container" *ngIf="loading">
    <mat-spinner diameter="50"></mat-spinner>
    <p>Cargando datos de la empresa...</p>
  </div>

  <!-- Formulario -->
  <mat-card *ngIf="!loading" class="empresa-card">
    <mat-card-header>
      <mat-icon mat-card-avatar>business</mat-icon>
      <mat-card-title>Datos de Mi Empresa</mat-card-title>
      <mat-card-subtitle>Actualiza la información de tu empresa</mat-card-subtitle>
    </mat-card-header>

    <mat-card-content>
      <form [formGroup]="empresaForm" class="empresa-form">

        <!-- RUC (solo lectura) -->
        <div class="form-section">
          <h3>Identificación</h3>
          <div class="form-group">
            <label>RUC</label>
            <div class="input-with-icon readonly">
              <input type="text" formControlName="ruc" readonly>
              <mat-icon>lock</mat-icon>
            </div>
            <span class="hint">El RUC no puede ser modificado</span>
          </div>
        </div>

        <mat-divider></mat-divider>

        <!-- Información General -->
        <div class="form-section">
          <h3>Información General</h3>

          <div class="form-group">
            <label>Razón Social <span class="required">*</span></label>
            <input type="text" formControlName="razonSocial" placeholder="Nombre legal de la empresa">
            <span class="error" *ngIf="empresaForm.get('razonSocial')?.invalid && empresaForm.get('razonSocial')?.touched">
              {{ getErrorMessage('razonSocial') }}
            </span>
          </div>

          <div class="form-group">
            <label>Rubro Comercial</label>
            <input type="text" formControlName="rubroComercial" placeholder="Ej: Construcción, Minería, Servicios...">
            <span class="error" *ngIf="empresaForm.get('rubroComercial')?.invalid && empresaForm.get('rubroComercial')?.touched">
              {{ getErrorMessage('rubroComercial') }}
            </span>
          </div>

          <div class="form-group">
            <label>Dirección</label>
            <textarea formControlName="direccion" rows="2" placeholder="Dirección fiscal de la empresa"></textarea>
            <span class="error" *ngIf="empresaForm.get('direccion')?.invalid && empresaForm.get('direccion')?.touched">
              {{ getErrorMessage('direccion') }}
            </span>
          </div>
        </div>

        <mat-divider></mat-divider>

        <!-- Contacto -->
        <div class="form-section">
          <h3>Información de Contacto</h3>

          <div class="form-row">
            <div class="form-group">
              <label>Teléfono</label>
              <div class="input-with-icon">
                <mat-icon>phone</mat-icon>
                <input type="text" formControlName="telefono" placeholder="Ej: 01-2345678">
              </div>
              <span class="error" *ngIf="empresaForm.get('telefono')?.invalid && empresaForm.get('telefono')?.touched">
                {{ getErrorMessage('telefono') }}
              </span>
            </div>

            <div class="form-group">
              <label>Email</label>
              <div class="input-with-icon">
                <mat-icon>email</mat-icon>
                <input type="email" formControlName="email" placeholder="contacto@empresa.com">
              </div>
              <span class="error" *ngIf="empresaForm.get('email')?.invalid && empresaForm.get('email')?.touched">
                {{ getErrorMessage('email') }}
              </span>
            </div>
          </div>

          <div class="form-group">
            <label>Sitio Web</label>
            <div class="input-with-icon">
              <mat-icon>language</mat-icon>
              <input type="text" formControlName="sitioWeb" placeholder="https://www.miempresa.com">
            </div>
            <span class="error" *ngIf="empresaForm.get('sitioWeb')?.invalid && empresaForm.get('sitioWeb')?.touched">
              {{ getErrorMessage('sitioWeb') }}
            </span>
          </div>
        </div>

      </form>
    </mat-card-content>

    <mat-card-actions align="end">
      <button mat-button (click)="cancelar()" [disabled]="saving">
        Cancelar
      </button>
      <button mat-flat-button color="primary" (click)="guardarCambios()" [disabled]="saving || empresaForm.invalid">
        <mat-spinner *ngIf="saving" diameter="20" class="btn-spinner"></mat-spinner>
        <span *ngIf="!saving">Guardar Cambios</span>
      </button>
    </mat-card-actions>
  </mat-card>

</div>
